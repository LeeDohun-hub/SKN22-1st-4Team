<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¦¬ì½œ í”„ë¡œí•„ ë¶„ì„ (Lemon Scanner v2)</title>
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <style>
        /* íƒ­ UI ìŠ¤íƒ€ì¼ */
        .tab-button {
            @apply px-5 py-3 text-lg font-medium text-gray-500 border-b-4 border-transparent transition;
        }
        .tab-button.active {
            @apply text-blue-600 border-blue-600;
        }
        .tab-content {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
        }
        .tab-content.active {
            display: block; /* í™œì„± íƒ­ë§Œ ë³´ì„ */
        }

        /* [ê¸°ëŠ¥ 1] ë¦¬ì½œ í”„ë¡œí•„ ìŠ¤íƒ€ì¼ */
        .profile-stat {
            @apply flex justify-between items-center py-3 px-4 border-b;
        }
        .profile-stat-label {
            @apply text-sm font-medium text-gray-600;
        }
        .profile-stat-value {
            @apply text-lg font-bold text-gray-900;
        }
        /* [ê¸°ëŠ¥ 1] í™•ì¸í•„ìš” ë¦¬ì½œ (ì „ë¬¸ì ì¸ ê²½ê³ ) */
        .profile-stat-danger {
            @apply text-red-700;
        }

        /* [ê¸°ëŠ¥ 2] í‚¤ì›Œë“œ íƒœê·¸ ìŠ¤íƒ€ì¼ */
        .keyword-tag {
            @apply inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-1 rounded-full mr-1 mb-1;
        }

        /* [ê¸°ëŠ¥ 3] ìƒì„¸ ë¦¬ì½œ í…Œì´ë¸” (ì „ë¬¸ì ì¸ ê²½ê³ ) */
        .rate-danger {
            @apply text-red-700 font-bold;
        }
        .rate-warning {
            @apply text-yellow-600 font-bold;
        }
        .rate-safe {
            @apply text-green-700;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-6">
            <h1 class="text-4xl font-bold text-blue-800">ğŸš— ì¤‘ê³ ì°¨ ë¦¬ì½œ í”„ë¡œí•„ ë¶„ì„</h1>
            <p class="text-lg text-gray-600 mt-2">êµ¬ë§¤ ì „, ê°ê´€ì ì¸ ë¦¬ì½œ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
        </header>

        <!-- [íƒ­ ë²„íŠ¼ ì˜ì—­] -->
        <div class="mb-6 border-b border-gray-300 flex justify-center space-x-4">
            <button class="tab-button active" data-tab="search">ğŸ” ë¦¬ì½œ í”„ë¡œí•„ ê²€ìƒ‰</button>
            <button class="tab-button" data-tab="compare">âš–ï¸ ëª¨ë¸ ë¹„êµ (A vs B)</button>
            <button class="tab-button" data-tab="about">â„¹ï¸ ì„œë¹„ìŠ¤ ì†Œê°œ</button>
        </div>

        <!-- 1. [ë¦¬ì½œ í”„ë¡œí•„ ê²€ìƒ‰] íƒ­ -->
        <div id="tab-search" class="tab-content active">
            <div class="flex flex-col lg:flex-row gap-6">
                
                <!-- ì‚¬ì´ë“œë°”: ê²€ìƒ‰ í•„í„° -->
                <aside class="lg:w-1/3 w-full bg-white p-6 rounded-lg shadow-md h-full sticky top-4">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ğŸ” ê²€ìƒ‰ ì¡°ê±´</h2>
                    
                    <div class="mb-4">
                        <label for="brand-select" class="block text-sm font-bold text-gray-700 mb-1">1. ì œì¡°ì‚¬</label>
                        <select id="brand-select" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                            <option value="">-- ì œì¡°ì‚¬ ì„ íƒ --</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="model-select" class="block text-sm font-bold text-gray-700 mb-1">2. ì°¨ì¢…</label>
                        <select id="model-select" class="w-full p-2 border border-gray-300 rounded-md bg-gray-100" disabled>
                            <option value="">-- ì œì¡°ì‚¬ë¥¼ ë¨¼ì € ì„ íƒ --</option>
                        </select>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-1">3. ë¦¬ì½œ ì—°ë„ (ê°œì‹œì¼)</label>
                        <div class="flex items-center gap-2">
                            <input type="number" id="year-start" class="w-full p-2 border rounded-md text-center" value="2018">
                            <span class="text-gray-500">~</span>
                            <input type="number" id="year-end" class="w-full p-2 border rounded-md text-center" value="2024">
                        </div>
                    </div>
                    
                    <button id="search-button" class="w-full bg-blue-600 text-white py-3 px-4 rounded-md font-bold hover:bg-blue-700 transition shadow-lg transform active:scale-95">
                        ë¦¬ì½œ í”„ë¡œí•„ ìƒì„±
                    </button>
                </aside>

                <!-- ë©”ì¸ ì½˜í…ì¸ : ë¦¬ì½œ í”„ë¡œí•„ + ìƒì„¸ ë‚´ì—­ -->
                <main class="lg:w-2/3 w-full space-y-6">
                    
                    <!-- [ê¸°ëŠ¥ 1] ë¦¬ì½œ í”„ë¡œí•„ (ê°ê´€ì  íŒ©íŠ¸) -->
                    <section class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“„ ë¦¬ì½œ í”„ë¡œí•„</h2>
                        <div id="profile-box" class="bg-gray-50 rounded-lg border border-gray-200">
                            <div class="text-center py-12 text-gray-500">
                                <p>ì°¨ëŸ‰ì„ ì„ íƒí•˜ê³  'í”„ë¡œí•„ ìƒì„±' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
                            </div>
                        </div>
                    </section>
                    
                    <!-- [ê¸°ëŠ¥ 2] ìƒì„¸ ë¦¬ì½œ ë‚´ì—­ -->
                    <section class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“‹ ìƒì„¸ ë¦¬ì½œ ë‚´ì—­</h2>
                        <div id="results-container" class="overflow-x-auto">
                            <p class="text-gray-500 text-center py-4">í”„ë¡œí•„ ìƒì„± ì‹œ ìƒì„¸ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                        </div>
                    </section>
                </main>
            </div>
        </div>

        <!-- 2. [ëª¨ë¸ ë¹„êµ] íƒ­ -->
        <div id="tab-compare" class="tab-content">
            <div class="bg-white p-8 rounded-lg shadow-md">
                <h2 class="text-3xl font-bold text-gray-800 mb-2 text-center">âš–ï¸ ê²½ìŸ ëª¨ë¸ ë¦¬ì½œ í”„ë¡œí•„ ë¹„êµ</h2>
                <p class="text-center text-gray-600 mb-8">êµ¬ë§¤ë¥¼ ë§ì„¤ì´ëŠ” ë‘ ì°¨ëŸ‰ì˜ ë¦¬ì½œ ì´ë ¥ì„ ê°ê´€ì ìœ¼ë¡œ ë¹„êµí•©ë‹ˆë‹¤.</p>
                
                <!-- ë¹„êµ ì„ íƒê¸° -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <!-- ëª¨ë¸ A ì„ íƒ -->
                    <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                        <h3 class="text-xl font-semibold text-blue-700 mb-4 text-center">Model A (ë¹„êµ ëŒ€ìƒ 1)</h3>
                        <div class="mb-4">
                            <label for="brand-a-select" class="block text-sm font-bold text-gray-700 mb-1">ì œì¡°ì‚¬</label>
                            <select id="brand-a-select" class="w-full p-2 border border-gray-300 rounded-md">
                                <option value="">-- ì œì¡°ì‚¬ ì„ íƒ --</option>
                            </select>
                        </div>
                        <div>
                            <label for="model-a-select" class="block text-sm font-bold text-gray-700 mb-1">ì°¨ì¢…</label>
                            <select id="model-a-select" class="w-full p-2 border border-gray-300 rounded-md bg-gray-100" disabled>
                                <option value="">-- ì œì¡°ì‚¬ ë¨¼ì € --</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ëª¨ë¸ B ì„ íƒ -->
                    <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                        <h3 class="text-xl font-semibold text-green-700 mb-4 text-center">Model B (ë¹„êµ ëŒ€ìƒ 2)</h3>
                        <div class="mb-4">
                            <label for="brand-b-select" class="block text-sm font-bold text-gray-700 mb-1">ì œì¡°ì‚¬</label>
                            <select id="brand-b-select" class="w-full p-2 border border-gray-300 rounded-md">
                                <option value="">-- ì œì¡°ì‚¬ ì„ íƒ --</option>
                            </select>
                        </div>
                        <div>
                            <label for="model-b-select" class="block text-sm font-bold text-gray-700 mb-1">ì°¨ì¢…</label>
                            <select id="model-b-select" class="w-full p-2 border border-gray-300 rounded-md bg-gray-100" disabled>
                                <option value="">-- ì œì¡°ì‚¬ ë¨¼ì € --</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="text-center mb-8">
                    <button id="compare-button" class="bg-green-600 text-white py-3 px-8 rounded-md font-bold text-lg hover:bg-green-700 transition shadow-lg transform active:scale-95">
                        ë¹„êµ ê²°ê³¼ ë³´ê¸°
                    </button>
                </div>
                
                <!-- ë¹„êµ ê²°ê³¼ í…Œì´ë¸” -->
                <div id="compare-results" class="overflow-x-auto">
                    <!-- ë¹„êµ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- 3. [ì„œë¹„ìŠ¤ ì†Œê°œ] íƒ­ -->
        <div id="tab-about" class="tab-content bg-white p-8 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">â„¹ï¸ ì´ ì„œë¹„ìŠ¤ì— ëŒ€í•˜ì—¬</h2>
            <div class="space-y-4 text-gray-700 leading-relaxed">
                <p>
                    'ì¤‘ê³ ì°¨ ë¦¬ì½œ í”„ë¡œí•„ ë¶„ì„' ì„œë¹„ìŠ¤ëŠ” ì¤‘ê³ ì°¨ êµ¬ë§¤ ì‹œ ê°€ì¥ í™•ì¸í•˜ê¸° ì–´ë ¤ìš´ **'ë¦¬ì½œ ì´ë ¥'**ê³¼ **'ì‹¤ì œ ì‹œì • ì—¬ë¶€'**ë¥¼
                    ê°ê´€ì ì¸ ë°ì´í„°ë¡œ ë¶„ì„í•˜ì—¬ ì œê³µí•©ë‹ˆë‹¤.
                </p>
                <p>
                    ë‹¨ìˆœíˆ "ë¦¬ì½œì´ ìˆì—ˆë‹¤"ëŠ” ì‚¬ì‹¤ì„ ë„˜ì–´, í•´ë‹¹ ë¦¬ì½œì´ ì–¼ë§ˆë‚˜ **'ì¹˜ëª…ì ì¸ ê²°í•¨(í‚¤ì›Œë“œ)'**ê³¼ ê´€ë ¨ ìˆëŠ”ì§€,
                    ê·¸ë¦¬ê³  ë¦¬ì½œ ëŒ€ìƒ ì°¨ëŸ‰ ì¤‘ **'ëª‡ í¼ì„¼íŠ¸ê°€ ì‹¤ì œë¡œ ìˆ˜ë¦¬(ì‹œì •ë¥ )'**ë˜ì—ˆëŠ”ì§€ì— ëŒ€í•œ
                    'íŒ©íŠ¸'ì— ê¸°ë°˜í•œ í”„ë¡œí•„ì„ ì œê³µí•˜ì—¬ í˜„ëª…í•œ êµ¬ë§¤ ê²°ì •ì„ ë•ìŠµë‹ˆë‹¤.
                </p>
            </div>
            <h3 class="text-xl font-semibold text-gray-700 mt-8 mb-2">ğŸ“Š ë°ì´í„° ì¶œì²˜</h3>
            <p class="text-gray-700">ì´ ì„œë¹„ìŠ¤ëŠ” <strong>í•œêµ­êµí†µì•ˆì „ê³µë‹¨(KOTSA) ìë™ì°¨ ë¦¬ì½œ ì„¼í„°</strong>ì˜ ê³µê³µë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        // -------------------------------------------------------------------
        // [ë°±ì—”ë“œ ì‹œë®¬ë ˆì´ì…˜: Mock Data]
        // -------------------------------------------------------------------
        
        const MOCK_BRANDS = [
            { brand_id: 1, brand_name: 'í˜„ëŒ€' },
            { brand_id: 2, brand_name: 'ê¸°ì•„' },
            { brand_id: 3, brand_name: 'GM' },
            { brand_id: 4, brand_name: 'ë¥´ë…¸' },
            { brand_id: 5, brand_name: 'ë²¤ì¸ ' },
            { brand_id: 6, brand_name: 'BMW' },
        ];

        const MOCK_MODELS = {
            1: [ // í˜„ëŒ€
                { model_id: 101, model_name: 'ì˜ë‚˜íƒ€ (DN8)' },
                { model_id: 102, model_name: 'ì•„ë°˜ë–¼ (CN7)' },
                { model_id: 103, model_name: 'ê·¸ëœì € (IG)' },
            ],
            2: [ // ê¸°ì•„
                { model_id: 201, model_name: 'K5 (DL3)' },
                { model_id: 202, model_name: 'K8 (GL3)' },
                { model_id: 203, model_name: 'ìŠ¤í¬í‹°ì§€ (NQ5)' },
            ],
            // ... (ë‹¤ë¥¸ ë¸Œëœë“œ ëª¨ë¸ë“¤)
        };
        
        // ìƒì„¸ ë¦¬ì½œ ë‚´ì—­ ë°ì´í„° (í”„ë¡œí•„ ê³„ì‚°ì˜ ê·¼ê±°)
        const MOCK_RECALL_RESULTS = [
            // ì˜ë‚˜íƒ€ (DN8) - model_id: 101
            { model_id: 101, brand_name: 'í˜„ëŒ€', model_name: 'ì˜ë‚˜íƒ€ (DN8)', recall_date: '2023-01-05', reason: 'ì—”ì§„ ê´€ë ¨ ë¶€í’ˆ(ì»¤ë„¥íŒ… ë¡œë“œ)ì˜ ê²°í•¨ìœ¼ë¡œ ì£¼í–‰ ì¤‘ ì‹œë™ì´ êº¼ì§ˆ ê°€ëŠ¥ì„±.', keywords: ['ì—”ì§„', 'ì‹œë™'], correction_rate: 30.5 },
            { model_id: 101, brand_name: 'í˜„ëŒ€', model_name: 'ì˜ë‚˜íƒ€ (DN8)', recall_date: '2022-06-15', reason: 'ë¸Œë ˆì´í¬ ì ê¹€ ë°©ì§€(ABS) ì‹œìŠ¤í…œì˜ ì†Œí”„íŠ¸ì›¨ì–´ ì˜¤ë¥˜ë¡œ ì œë™ ê±°ë¦¬ê°€ ê¸¸ì–´ì§.', keywords: ['ë¸Œë ˆì´í¬', 'ì†Œí”„íŠ¸ì›¨ì–´'], correction_rate: 95.8 },
            { model_id: 101, brand_name: 'í˜„ëŒ€', model_name: 'ì˜ë‚˜íƒ€ (DN8)', recall_date: '2021-11-10', reason: 'ì—ì–´ë°± ì œì–´ ì¥ì¹˜(ACU) ê²°í•¨ìœ¼ë¡œ ì¶©ëŒ ì‹œ ì—ì–´ë°±ì´ ì „ê°œë˜ì§€ ì•Šì„ ìœ„í—˜.', keywords: ['ì—ì–´ë°±'], correction_rate: 45.2 },
            
            // K5 (DL3) - model_id: 201
            { model_id: 201, brand_name: 'ê¸°ì•„', model_name: 'K5 (DL3)', recall_date: '2023-05-20', reason: 'ì—°ë£Œ íŒí”„ ë‚´ë¶€ ë¶€í’ˆ ë§ˆëª¨ë¡œ ì¸í•œ ì—°ë£Œ ê³µê¸‰ ë¶ˆëŸ‰ ë° ì‹œë™ êº¼ì§ ê°€ëŠ¥ì„±.', keywords: ['ì—”ì§„', 'ëˆ„ìœ ', 'ì‹œë™'], correction_rate: 75.5 },
            { model_id: 201, brand_name: 'ê¸°ì•„', model_name: 'K5 (DL3)', recall_date: '2022-08-10', reason: 'ì „ìì‹ ë³€ì† ì œì–´ì¥ì¹˜(SCU) ì†Œí”„íŠ¸ì›¨ì–´ ì˜¤ë¥˜ë¡œ ì£¼ì°¨ ì‹œ ì°¨ëŸ‰ ë°€ë¦¼ í˜„ìƒ.', keywords: ['ì†Œí”„íŠ¸ì›¨ì–´'], correction_rate: 98.0 },
            { model_id: 201, brand_name: 'ê¸°ì•„', model_name: 'K5 (DL3)', recall_date: '2021-05-03', reason: 'ì—°ë£Œ ëˆ„ìœ  ê°€ëŠ¥ì„±', keywords: ['ëˆ„ìœ '], correction_rate: 85.0 },

            // ê·¸ëœì € (IG) - model_id: 103
            { model_id: 103, brand_name: 'í˜„ëŒ€', model_name: 'ê·¸ëœì € (IG)', recall_date: '2022-01-01', reason: 'ë°°í„°ë¦¬ ê´€ë¦¬ ì‹œìŠ¤í…œ(BMS) ì˜¤ë¥˜ë¡œ í™”ì¬ ë°œìƒ ê°€ëŠ¥ì„±.', keywords: ['ë°°í„°ë¦¬', 'í™”ì¬'], correction_rate: 100.0 },
        ];


        // -------------------------------------------------------------------
        // [í”„ë¡ íŠ¸ì—”ë“œ ë¡œì§: JavaScript]
        // -------------------------------------------------------------------
        
        $(document).ready(function() {
            
            // --- [í•µì‹¬ ë°±ì—”ë“œ í•¨ìˆ˜] ë¦¬ì½œ í”„ë¡œí•„ ìƒì„± (ì‹œë®¬ë ˆì´ì…˜) ---
            function generateRecallProfile(modelId) {
                if (!modelId) return null;
                
                // 1. í•´ë‹¹ ëª¨ë¸ì˜ ë¦¬ì½œ ë‚´ì—­ í•„í„°ë§
                const recalls = MOCK_RECALL_RESULTS.filter(r => r.model_id.toString() === modelId.toString());
                
                if (recalls.length === 0) {
                    return { total: 0, keywords: [], avgRate: 'N/A', toCheck: 0 };
                }
                
                let totalRate = 0;
                let toCheck = 0;
                const keywords = new Set();
                
                // 2. ë°ì´í„° ì§‘ê³„
                recalls.forEach(r => {
                    totalRate += r.correction_rate;
                    if (r.correction_rate < 50) {
                        toCheck++; // ì‹œì •ë¥  50% ë¯¸ë§Œ ê±´ìˆ˜
                    }
                    r.keywords.forEach(k => keywords.add(k));
                });
                
                // 3. íŒ©íŠ¸ ê³„ì‚°
                const avgRate = (totalRate / recalls.length).toFixed(1);
                
                // 4. ê°ê´€ì ì¸ íŒ©íŠ¸ í”„ë¡œí•„ ë°˜í™˜
                return {
                    total: recalls.length,
                    keywords: Array.from(keywords),
                    avgRate: avgRate,
                    toCheck: toCheck
                };
            }

            // --- 1. ì´ˆê¸°í™” í•¨ìˆ˜ ---
            
            // ê³µí†µ: ë¸Œëœë“œ ëª©ë¡ ì±„ìš°ê¸° (A, B, Search íƒ­ ëª¨ë‘)
            function populateBrands() {
                let options = '<option value="">-- ì œì¡°ì‚¬ ì„ íƒ --</option>';
                MOCK_BRANDS.forEach(brand => {
                    options += `<option value="${brand.brand_id}">${brand.brand_name}</option>`;
                });
                $('#brand-select, #brand-a-select, #brand-b-select').html(options);
            }

            // ê³µí†µ: ëª¨ë¸ ëª©ë¡ ì±„ìš°ê¸° (A, B, Search íƒ­ ëª¨ë‘)
            function populateModels(brandId, $modelSelect) {
                $modelSelect.empty().append('<option value="">-- ì°¨ì¢… ì„ íƒ --</option>');
                
                if (brandId && MOCK_MODELS[brandId]) {
                    const models = MOCK_MODELS[brandId];
                    models.forEach(model => {
                        $modelSelect.append(`<option value="${model.model_id}">${model.model_name}</option>`);
                    });
                    $modelSelect.prop('disabled', false).removeClass('bg-gray-100').addClass('bg-white');
                } else {
                    $modelSelect.prop('disabled', true).addClass('bg-gray-100').removeClass('bg-white');
                    $modelSelect.html('<option value="">-- ì œì¡°ì‚¬ë¥¼ ë¨¼ì € ì„ íƒ --</option>');
                }
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ
            populateBrands();

            // --- 2. ë Œë”ë§ í•¨ìˆ˜ (HTML ìƒì„±) ---

            // [ê¸°ëŠ¥ 1] ë¦¬ì½œ í”„ë¡œí•„ ë°•ìŠ¤ ë Œë”ë§
            function renderProfileBox(profile, modelName) {
                const $box = $('#profile-box');
                if (!profile) {
                    $box.html('<div class="text-center py-12 text-gray-500"><p>ì°¨ëŸ‰ì„ ì„ íƒí•˜ê³  \'í”„ë¡œí•„ ìƒì„±\' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p></div>');
                    return;
                }
                
                let keywordTags = '<span class="text-gray-500">N/A</span>';
                if (profile.keywords.length > 0) {
                    keywordTags = profile.keywords.map(k => `<span class="keyword-tag">#${k}</span>`).join(' ');
                }

                // [ì¤‘ìš”] 'í™•ì¸í•„ìš” ë¦¬ì½œ'ì— ì „ë¬¸ì ì¸ ê²½ê³  ìŠ¤íƒ€ì¼ ì ìš©
                let toCheckClass = profile.toCheck > 0 ? 'profile-stat-danger' : '';

                $box.html(`
                    <h3 class="text-xl font-bold text-gray-800 p-4 border-b">${modelName}</h3>
                    <div class="profile-stat">
                        <span class="profile-stat-label">ëˆ„ì  ë¦¬ì½œ ê±´ìˆ˜</span>
                        <span class="profile-stat-value">${profile.total} ê±´</span>
                    </div>
                    <div class="profile-stat">
                        <span class="profile-stat-label">í‰ê·  ì‹œì •ë¥ </span>
                        <span class="profile-stat-value">${profile.avgRate}%</span>
                    </div>
                    <div class="profile-stat">
                        <span class="profile-stat-label">í™•ì¸í•„ìš” ë¦¬ì½œ (ì‹œì •ë¥  50%â†“)</span>
                        <span class="profile-stat-value ${toCheckClass}">${profile.toCheck} ê±´</span>
                    </div>
                    <div class="p-4">
                        <span class="profile-stat-label">ì£¼ìš” ê²°í•¨ í‚¤ì›Œë“œ</span>
                        <div class="mt-2">${keywordTags}</div>
                    </div>
                `);
            }
            
            // [ê¸°ëŠ¥ 2] ìƒì„¸ ë¦¬ì½œ í…Œì´ë¸” ë Œë”ë§
            function renderResultsTable(modelId) {
                const $container = $('#results-container');
                const recalls = MOCK_RECALL_RESULTS.filter(r => r.model_id.toString() === modelId.toString());

                if (recalls.length === 0) {
                    $container.html('<p class="text-gray-500 text-center py-4">ìƒì„¸ ë¦¬ì½œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>');
                    return;
                }

                let html = `
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-600 uppercase w-3/5">ë¦¬ì½œ ì‚¬ìœ </th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-600 uppercase w-1/5">ê°œì‹œì¼</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-600 uppercase w-1/5">ì‹œì •ë¥ </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                `;

                recalls.forEach(row => {
                    let rate = parseFloat(row.correction_rate);
                    let rateClass = 'rate-safe'; // 80% ì´ìƒ
                    if (rate < 50) rateClass = 'rate-danger';
                    else if (rate < 80) rateClass = 'rate-warning';

                    html += `
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-4 align-top">
                                <p class="text-sm text-gray-900" style="white-space: normal;">${row.reason}</p>
                            </td>
                            <td class="px-4 py-4 align-top text-sm text-gray-500">${row.recall_date}</td>
                            <td class="px-4 py-4 align-top text-sm ${rateClass}">${rate}%</td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                $container.html(html);
            }

            // [ê¸°ëŠ¥ 3] A vs B ë¹„êµ í…Œì´ë¸” ë Œë”ë§
            function renderCompareTable(profileA, modelAName, profileB, modelBName) {
                const $container = $('#compare-results');
                
                if (!profileA || !profileB) {
                     $container.html('<p class="text-gray-500 text-center py-4">ë¹„êµí•  ë‘ ëª¨ë¸ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.</p>');
                    return;
                }
                
                function getStatHtml(profile) {
                    let keywords = profile.keywords.length > 0 ? profile.keywords.map(k => `<span class="keyword-tag">#${k}</span>`).join(' ') : 'N/A';
                    let toCheckClass = profile.toCheck > 0 ? 'profile-stat-danger' : '';
                    return `
                        <td class="p-4 text-center">
                            <span class="profile-stat-value">${profile.total} ê±´</span>
                        </td>
                        <td class="p-4">${keywords}</td>
                        <td class="p-4 text-center">
                            <span class="profile-stat-value">${profile.avgRate}%</span>
                        </td>
                        <td class="p-4 text-center">
                            <span class="profile-stat-value ${toCheckClass}">${profile.toCheck} ê±´</span>
                        </td>
                    `;
                }

                let html = `
                    <table class="min-w-full divide-y divide-gray-200 border">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-600 uppercase">ë¹„êµ í•­ëª©</th>
                                <th class="px-4 py-3 text-center text-xs font-bold text-blue-700 uppercase">${modelAName}</th>
                                <th class="px-4 py-3 text-center text-xs font-bold text-green-700 uppercase">${modelBName}</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-4 py-4 font-medium">ëˆ„ì  ë¦¬ì½œ ê±´ìˆ˜</td>
                                ${getStatHtml(profileA).split('</td>').slice(0, 1).join('</td>') + '</td>'}
                                ${getStatHtml(profileB).split('</td>').slice(0, 1).join('</td>') + '</td>'}
                            </tr>
                            <tr>
                                <td class="px-4 py-4 font-medium">ì£¼ìš” ê²°í•¨ í‚¤ì›Œë“œ</td>
                                ${getStatHtml(profileA).split('</td>').slice(1, 2).join('</td>') + '</td>'}
                                ${getStatHtml(profileB).split('</td>').slice(1, 2).join('</td>') + '</td>'}
                            </tr>
                            <tr>
                                <td class="px-4 py-4 font-medium">í‰ê·  ì‹œì •ë¥ </td>
                                ${getStatHtml(profileA).split('</td>').slice(2, 3).join('</td>') + '</td>'}
                                ${getStatHtml(profileB).split('</td>').slice(2, 3).join('</td>') + '</td>'}
                            </tr>
                            <tr>
                                <td class="px-4 py-4 font-medium">í™•ì¸í•„ìš” ë¦¬ì½œ (50%â†“)</td>
                                ${getStatHtml(profileA).split('</td>').slice(3, 4).join('</td>') + '</td>'}
                                ${getStatHtml(profileB).split('</td>').slice(3, 4).join('</td>') + '</td>'}
                            </tr>
                        </tbody>
                    </table>
                `;
                $container.html(html);
            }

            // --- 3. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë°”ì¸ë”© ---

            // íƒ­ í´ë¦­
            $('.tab-button').on('click', function() {
                const tabId = $(this).data('tab');
                $('.tab-button').removeClass('active');
                $(this).addClass('active');
                $('.tab-content').removeClass('active');
                $('#tab-' + tabId).addClass('active');
            });

            // [ê²€ìƒ‰ íƒ­] ë¸Œëœë“œ ì„ íƒ
            $('#brand-select').on('change', function() {
                populateModels($(this).val(), $('#model-select'));
            });

            // [ê²€ìƒ‰ íƒ­] 'í”„ë¡œí•„ ìƒì„±' ë²„íŠ¼ í´ë¦­
            $('#search-button').on('click', function() {
                const modelId = $('#model-select').val();
                const modelName = $('#model-select option:selected').text();
                
                if (!modelId) {
                    alert("ì œì¡°ì‚¬ì™€ ì°¨ì¢…ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return;
                }

                // 1. í”„ë¡œí•„ ìƒì„± ë° ë Œë”ë§
                const profile = generateRecallProfile(modelId);
                renderProfileBox(profile, modelName);
                
                // 2. ìƒì„¸ ë‚´ì—­ í…Œì´ë¸” ë Œë”ë§
                renderResultsTable(modelId);
            });

            // [ë¹„êµ íƒ­] ë¸Œëœë“œ A ì„ íƒ
            $('#brand-a-select').on('change', function() {
                populateModels($(this).val(), $('#model-a-select'));
            });

            // [ë¹„êµ íƒ­] ë¸Œëœë“œ B ì„ íƒ
            $('#brand-b-select').on('change', function() {
                populateModels($(this).val(), $('#model-b-select'));
            });

            // [ë¹„êµ íƒ­] 'ë¹„êµ ê²°ê³¼ ë³´ê¸°' ë²„íŠ¼ í´ë¦­
            $('#compare-button').on('click', function() {
                const modelAId = $('#model-a-select').val();
                const modelBId = $('#model-b-select').val();
                const modelAName = $('#model-a-select option:selected').text();
                const modelBName = $('#model-b-select option:selected').text();

                if (!modelAId || !modelBId) {
                    alert("ë¹„êµí•  ë‘ ëª¨ë¸ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return;
                }

                const profileA = generateRecallProfile(modelAId);
                const profileB = generateRecallProfile(modelBId);
                
                renderCompareTable(profileA, modelAName, profileB, modelBName);
            });

        });
    </script>

</body>
</html>